<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Navaraa Admin UI</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<style>
body {
    font-family: 'Poppins', sans-serif;
    background: #f0f2f5;
    margin:0;
    padding:0;
}
.container {
    max-width: 500px;
    margin: 50px auto;
    background:#fff;
    padding:25px;
    border-radius:15px;
    box-shadow:0 8px 24px rgba(0,0,0,0.15);
}
h2 {
    text-align:center;
    margin-bottom:20px;
}
input, button {
    width:100%;
    padding:10px;
    margin:8px 0;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:16px;
}
button {
    cursor:pointer;
    background:#4facfe;
    color:#fff;
    font-weight:600;
    border:none;
}
button:hover {
    background:#00f2fe;
}
.status {
    background:#f5f5f5;
    padding:10px;
    border-radius:8px;
    margin:10px 0;
    font-weight:600;
}
</style>
</head>
<body>
<div class="container">
    <h2>Navaraa Admin Panel</h2>
    <button id="connectBtn">Connect Owner Wallet</button>
    <div class="status" id="ownerAddress">Not Connected</div>

    <h3>Fund Contract (Reward)</h3>
    <input type="number" id="fundAmount" placeholder="Enter amount to fund">
    <button onclick="fundContract()">Add Fund</button>

    <h3>Rescue Tokens</h3>
    <input type="text" id="rescueToken" placeholder="Token address to rescue">
    <input type="number" id="rescueAmount" placeholder="Amount to rescue">
    <button onclick="rescueTokens()">Rescue</button>

    <h3>Live Info</h3>
    <div class="status">Reward Fund: <span id="rewardFund">-</span></div>
    <div class="status">Total Stakers: <span id="totalStakers">-</span></div>

</div>

<script>
const CONTRACT_ADDRESS = "0x9fd473975cecd4587d78eb71f4498dde778c4b83"; // Staking contract
const TOKEN_ADDRESS = "0x23b7a4c2ec9d742b5b1698149e812ca1e10d3e73"; // NAVAA token

const ABI = [
    "function totalRewardLiability() view returns(uint256)",
    "function stakeCount(address user) view returns(uint256)",
    "function fund(uint256 amount)",
    "function rescueERC20(address tokenAddress, uint256 amount) external",
];

const TOKEN_ABI = [
    "function approve(address spender, uint256 amount) returns(bool)",
    "function balanceOf(address account) view returns(uint256)",
    "function decimals() view returns(uint8)"
];

let provider, signer, contract, tokenContract, ownerAddress;

document.getElementById("connectBtn").onclick = async () => {
    if(window.ethereum){
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        ownerAddress = await signer.getAddress();
        document.getElementById("ownerAddress").innerText = ownerAddress;
        contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
        tokenContract = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, signer);
        loadLiveInfo();
    } else { alert("Please install MetaMask"); }
}

async function fundContract() {
    try {
        const amount = document.getElementById("fundAmount").value;
        if(!amount || isNaN(amount) || parseFloat(amount)<=0){ alert("Enter valid amount"); return; }
        const decimals = await tokenContract.decimals();
        const amt = ethers.utils.parseUnits(amount.toString(), decimals);

        // approve first
        const approveTx = await tokenContract.approve(CONTRACT_ADDRESS, amt);
        await approveTx.wait();

        const tx = await contract.fund(amt);
        alert("Funding... Tx: "+tx.hash);
        await tx.wait();
        alert("Fund added!");
        loadLiveInfo();
    } catch(e){ console.error(e); alert(e.message); }
}

async function rescueTokens() {
    try {
        const tokenAddr = document.getElementById("rescueToken").value;
        const amount = document.getElementById("rescueAmount").value;
        if(!tokenAddr || !amount){ alert("Enter token address and amount"); return; }
        const decimals = await tokenContract.decimals();
        const amt = ethers.utils.parseUnits(amount.toString(), decimals);
        const tx = await contract.rescueERC20(tokenAddr, amt);
        alert("Rescuing tokens... Tx: "+tx.hash);
        await tx.wait();
        alert("Tokens rescued!");
        loadLiveInfo();
    } catch(e){ console.error(e); alert(e.message); }
}

async function loadLiveInfo() {
    if(!contract) return;
    const reward = await contract.totalRewardLiability();
    const decimals = await tokenContract.decimals();
    document.getElementById("rewardFund").innerText = ethers.utils.formatUnits(reward, decimals);

    // Total stakers counting
    // Here we assume you know user list off-chain or track via events; simple approximation:
    document.getElementById("totalStakers").innerText = "Check events in contract"; 
}
</script>
</body>
</html>
